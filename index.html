<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<title>Ã–ÄŸrenci Takip Sistemi</title>
<style>
  body { font-family: Arial; text-align: center; background: #f9f9f9; }
  table { border-collapse: collapse; margin: 20px auto; }
  td, th { border: 1px solid #ccc; padding: 6px 12px; }
  input { width: 80px; text-align: center; }
  #load { margin-top: 20px; }
</style>
</head>
<body>
  <h2>ðŸ“˜ Ã–ÄŸrenci Takip Sistemi</h2>
  <input id="name" placeholder="Sayfa adÄ± (Ã¶r: Merve)" />
  <button onclick="loadSheet()">AÃ§</button>
  <div id="load"></div>
  <table id="table"></table>
  <button onclick="saveRow()">Kaydet</button>

<script>
const apiURL = "https://script.google.com/macros/s/AKfycbwxkg567Zvpzn6zHCmGOsd7w6_Fw4NGrIbWcVAOT7pe_tTWuwi5xOjFZzg4c5h2hnowyw/exec";

let currentSheet = null;

async function loadSheet() {
  const name = document.getElementById("name").value.trim();
  if (!name) return alert("Sayfa adÄ± girin!");
  currentSheet = name;
  document.getElementById("load").innerText = "YÃ¼kleniyor...";

  try {
    const res = await fetch(`${apiURL}?name=${encodeURIComponent(name)}`);
    const data = await res.json();
    if (data.error) return alert(data.error);
    renderTable(data.data);
    document.getElementById("load").innerText = "";
  } catch (err) {
    document.getElementById("load").innerText = "BaÄŸlantÄ± hatasÄ±";
  }
}

function renderTable(rows) {
  const table = document.getElementById("table");
  table.innerHTML = "";
  rows.forEach((row, i) => {
    const tr = document.createElement("tr");
    row.forEach((cell, j) => {
      const td = document.createElement("td");
      if (i === rows.length - 1 && j > 0) {
        const inp = document.createElement("input");
        inp.type = "number";
        td.appendChild(inp);
      } else if (i === rows.length - 1 && j === 0) {
        td.innerText = "â†’ Otomatik tarih";
      } else {
        td.innerText = cell;
      }
      tr.appendChild(td);
    });
    table.appendChild(tr);
  });
}

async function saveRow() {
  if (!currentSheet) return alert("Ã–nce sayfa aÃ§Ä±n!");
  const lastRow = Array.from(document.querySelectorAll("tr:last-child td input"))
    .map(i => i.value);

  const body = {
    name: currentSheet,
    row: ["", ...lastRow]
  };

  const res = await fetch(apiURL, {
    method: "POST",
    body: JSON.stringify(body),
    headers: { "Content-Type": "application/json" }
  });

  const data = await res.json();
  if (data.success) {
    alert("Kaydedildi!");
    loadSheet();
  } else {
    alert("Hata: " + (data.error || "Bilinmeyen"));
  }
}
</script>
</body>
</html>
